<!doctype html><html lang=en xml:lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><link rel=stylesheet href=https://docs.pixelfed.org/styles/screen.min.8d1ce7623ee940f1b09da8420c5083be081c09d2512b6fcd42350b4fc97914c8.css integrity="sha256-jRznYj7pQPGwnahCDFCDvggcCdJRK2/NQjULT8l5FMg=" media=screen><link rel=stylesheet href=https://docs.pixelfed.org/styles/print.min.e399b939e5dd1816ad3f22420e0aa3b1fea185e165a11e714eb3316206beee39.css integrity="sha256-45m5OeXdGBatPyJCDgqjsf6hheFloR5xTrMxYga+7jk=" media=print><script type=text/javascript src=https://docs.pixelfed.org/script.min.81069bb548f190d3ae3c9c144ddcea6e3c6358ab2853fa55506821bf965ce49b.js integrity="sha256-gQabtUjxkNOuPJwUTdzqbjxjWKsoU/pVUGghv5Zc5Js="></script><style>a[href^="https\3a\2f\2f docs.pixelfed.org\2f "] svg{display:none!important}a[href^="http://localhost"] svg{display:none!important}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin=anonymous><title itemprop=name>Generic installation guide | Pixelfed Documentation</title><meta property="og:title" content="Generic installation guide"><meta name=twitter:title content="Generic installation guide"><meta name=application-name content="Pixelfed Documentation"><meta property="og:site_name" content="Pixelfed Documentation"><meta name=description content="How to set up everything you need to run your own Pixelfed instance."><meta itemprop=description content="How to set up everything you need to run your own Pixelfed instance."><meta property="og:description" content="How to set up everything you need to run your own Pixelfed instance."><meta name=twitter:description content="How to set up everything you need to run your own Pixelfed instance."><base href=https://docs.pixelfed.org/running-pixelfed/installation/><link rel=canonical href=https://docs.pixelfed.org/running-pixelfed/installation/ itemprop=url><meta name=url content="https://docs.pixelfed.org/running-pixelfed/installation/"><meta name=twitter:url content="https://docs.pixelfed.org/running-pixelfed/installation/"><meta property="og:url" content="https://docs.pixelfed.org/running-pixelfed/installation/"><meta itemprop=image content="https://docs.pixelfed.org/icon.png"><meta property="og:image" content="https://docs.pixelfed.org/icon.png"><meta name=twitter:image content="https://docs.pixelfed.org/icon.png"><meta name=twitter:image:src content="https://docs.pixelfed.org/icon.png"><meta property="og:updated_time" content="2022-12-09T01:20:44-0600"><meta property="og:type" content="website"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https://docs.pixelfed.org/running-pixelfed/installation/","name":"Pixelfed Documentation","logo":"https://docs.pixelfed.org/icon.png"}</script><link rel="shortcut icon" href=https://docs.pixelfed.org/icon.png sizes=512x512><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#ffffff"><link rel=sitemap type=application/xml title=Sitemap href=https://docs.pixelfed.org/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"></head><body><header class=site-header><div class=container><a href=/ class=site-masthead><img class=site-icon height=32 src="https://avatars0.githubusercontent.com/u/38410642?s=200&amp;amp;v=4"><p class=site-title>Pixelfed documentation</p></a><form id=search-form action=https://docs.pixelfed.org/search/ method=get><label hidden for=search-input>Search site</label>
<input id=search-input type=text name=query placeholder="Type here to search">
<input id=search-submit type=submit value=search></form><nav class=header-nav><ul class=menu><li class=pixelfed><a href=https://pixelfed.org><img src="https://avatars0.githubusercontent.com/u/38410642?s=200&v=4" height=24>
<span>pixelfed.org</span></a></li><li class=github><a href=https://github.com/pixelfed/docs><svg style="background:#fff;border:1px solid #fff;border-radius:100rem" height="1.5rem" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59C5.87 15.66 6.02 15.42 6.02 15.21 6.02 15.02 6.01 14.39 6.01 13.72 4 14.09 3.48 13.23 3.32 12.78 3.23 12.55 2.84 11.84 2.5 11.65 2.22 11.5 1.82 11.13 2.49 11.12 3.12 11.11 3.57 11.7 3.72 11.94 4.44 13.15 5.59 12.81 6.05 12.6 6.12 12.08 6.33 11.73 6.56 11.53 4.78 11.33 2.92 10.64 2.92 7.58c0-.87.31-1.59.82-2.15C3.66 5.23 3.38 4.41 3.82 3.31c0 0 .67-.21 2.2.82C6.66 3.95 7.34 3.86 8.02 3.86S9.38 3.95 10.02 4.13c1.53-1.04 2.2-.82 2.2-.82C12.66 4.41 12.38 5.23 12.3 5.43 12.81 5.99 13.12 6.7 13.12 7.58c0 3.07-1.87 3.75-3.65 3.95C9.76 11.78 10.01 12.26 10.01 13.01 10.01 14.08 10 14.94 10 15.21 10 15.42 10.15 15.67 10.55 15.59 13.71 14.53 16 11.53 16 8c0-4.42-3.58-8-8-8z" transform="scale(64)" fill="#1b1f23"/></svg><span>pixelfed/docs</span></a></li></ul></nav></div></header><div class=scroll-margin style=position:relative><div id=top style=scroll-margin-top:var(--header-height)></div></div><nav class=docs-nav><div class=container><input type=checkbox class=toggle-menu name=toggle id=toggle>
<label class=toggle-menu__label for=toggle><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h7"/></svg>Documentation Menu</label><ul class=menu><a id=menu href=#top>Skip menu</a><li class=section-title><a href=/running-pixelfed/><span>Run your own Pixelfed website</span></a><ul class=sub-menu><li><a href=/running-pixelfed/prerequisites/><span>Preparing your machine</span></a></li><li class=active><a href=/running-pixelfed/installation/><span>Generic installation guide</span></a></li><li><a href=/running-pixelfed/administration/><span>Administering your website</span></a></li><li><a href=/running-pixelfed/optional-features/><span>Optional features</span></a><ul class=sub-menu><li><a href=/running-pixelfed/optional-features/livestreaming/><span>Livestreaming (Pixelfed Live)</span></a></li><li><a href=/running-pixelfed/optional-features/websockets/><span>Websockets</span></a></li><li><a href=/running-pixelfed/optional-features/ldap-authentication/><span>LDAP Authentication</span></a></li></ul></li><li><a href=/running-pixelfed/troubleshooting/><span>Troubleshooting</span></a></li></ul></li><li class=section-title><a href=/developing-pixelfed/><span>Developing for Pixelfed</span></a><ul class=sub-menu><li><a href=/developing-pixelfed/intro/><span>Setting up your environment</span></a></li><li><a href=/developing-pixelfed/testing/><span>Running tests locally</span></a></li></ul></li><li class=section-title><a href=/technical-documentation/><span>Technical documentation</span></a><ul class=sub-menu><li><a href=/technical-documentation/activitypub/><span>ActivityPub</span></a></li><li><a href=/technical-documentation/api/><span>API</span></a></li><li><a href=/technical-documentation/artisan/><span>CLI</span></a></li><li><a href=/technical-documentation/config/><span>Configuration</span></a></li></ul></li><li class=section-title><a href=/install-guides/><span>Distro-specific install guides</span></a><ul class=sub-menu><li><a href=/install-guides/arch/><span>Arch Linux</span></a></li></ul></li></ul></div></nav><main><article class=page autonumbering><header class="section page-header"><div class=container><ul class=breadcrumbs><li><a href=/>Pixelfed Documentation</a></li><li><a href=/running-pixelfed/>Run your own Pixelfed website</a></li><li class=active><a href=/running-pixelfed/installation/>Generic installation guide</a></li></ul><h1 class=page-title>Generic installation guide</h1><p class=page-summary>How to set up everything you need to run your own Pixelfed instance.</p><p class=lastmod>Last modified <datetime class=date>Fri Dec 9, 2022</datetime><span class=edit-link><br><a href=https://github.com/pixelfed/docs/edit/main/content/en/running-pixelfed/installation.md>Edit this page</a></span></p></div></header><aside class="toc section"><div class=container><p class=toc-title>Page outline</p><nav id=TableOfContents><ol><li><a href=#setting-up-pixelfed-files>Setting up Pixelfed files</a><ol><li><a href=#download-source-via-git>Download source via Git</a></li><li><a href=#set-correct-permissions>Set correct permissions</a></li><li><a href=#initialize-php-dependencies>Initialize PHP dependencies</a></li></ol></li><li><a href=#configure-environment-variables>Configure environment variables</a><ol><li><a href=#app-variables>App variables</a></li><li><a href=#database-variables>Database variables</a></li><li><a href=#redis-variables>Redis variables</a></li><li><a href=#email-variables>Email variables</a></li><li><a href=#additional-variables>Additional variables</a></li></ol></li><li><a href=#setting-up-services>Setting up services</a><ol><li><a href=#one-time-setup-tasks>One-time setup tasks</a></li><li><a href=#job-queueing>Job queueing</a></li><li><a href=#scheduling-periodic-tasks>Scheduling periodic tasks</a></li><li><a href=#handling-web-requests>Handling web requests</a></li></ol></li></ol></nav></div></aside><section class="content section"><div class=container><p>Make sure you have all prerequisites installed and the appropriate services running/enabled before continuing.</p><div class='warning hint'><p><strong>WARNING</strong></p><p>Pixelfed is still a work in progress. We do not recommend running an instance in production at this stage unless you know what you are doing!</p></div><h2 class=heading id=setting-up-pixelfed-files><span class=heading__text>Setting up Pixelfed files</span>
<a class=heading__anchor-link href=#setting-up-pixelfed-files>[link]</a></h2><h3 class=heading id=download-source-via-git><span class=heading__text>Download source via Git</span>
<a class=heading__anchor-link href=#download-source-via-git>[link]</a></h3><p>Pixelfed Beta currently uses the <code>dev</code> branch for deployable code. When v1.0 is released, the stable branch will be changed to <code>stable</code>, with <code>dev</code> branch being used for development and testing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class="line hl"><span class=cl><span class=nb>cd</span> /usr/share/webapps <span class=c1># or wherever you choose to install web applications</span>
</span></span><span class=line><span class=cl>git clone -b dev https://github.com/pixelfed/pixelfed.git pixelfed <span class=c1># checkout dev branch into &#34;pixelfed&#34; folder</span>
</span></span></code></pre></div><h3 class=heading id=set-correct-permissions><span class=heading__text>Set correct permissions</span>
<a class=heading__anchor-link href=#set-correct-permissions>[link]</a></h3><p>Your web server and app processes need to be able to write to the Pixelfed directory. Make sure to set the appropriate permissions. For example, if you are running your processes through the <code>http</code> user/group, then run the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> pixelfed
</span></span><span class="line hl"><span class=cl>sudo chown -R http:http . <span class=c1># change user/group to http user and http group</span>
</span></span><span class=line><span class=cl>sudo find . -type d -exec chmod <span class=m>755</span> <span class=o>{}</span> <span class=se>\;</span> <span class=c1># set all directories to rwx by user/group</span>
</span></span><span class=line><span class=cl>sudo find . -type f -exec chmod <span class=m>644</span> <span class=o>{}</span> <span class=se>\;</span> <span class=c1># set all files to rw by user/group</span>
</span></span></code></pre></div><div class='danger hint'><p><strong>User and group permissions</strong></p><p>Make sure to use the correct user/group name for your system. This may be <code>http</code>, <code>www-data</code>, or <code>pixelfed</code> (if using a dedicated user).</p></div><h3 class=heading id=initialize-php-dependencies><span class=heading__text>Initialize PHP dependencies</span>
<a class=heading__anchor-link href=#initialize-php-dependencies>[link]</a></h3><p>Run <code>composer install</code> to fetch the dependencies needed by Pixelfed. It is recommended to run with the following flags:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>composer install --no-ansi --no-interaction --optimize-autoloader
</span></span></code></pre></div><h2 class=heading id=configure-environment-variables><span class=heading__text>Configure environment variables</span>
<a class=heading__anchor-link href=#configure-environment-variables>[link]</a></h2><p>By default Pixelfed comes with a <code>.env.example</code> file for production deployments, and a <code>.env.testing</code> file for debug deployments. You&rsquo;ll need to rename or copy one of these files to <code>.env</code> regardless of which environment you&rsquo;re working on.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp .env.example .env <span class=c1># for production deployments</span>
</span></span><span class=line><span class=cl>cp .env.testing .env <span class=c1># for debug deployments</span>
</span></span></code></pre></div><p>You can now edit <code>.env</code> and change values for your setup.</p><div class='tip hint'><p><strong>List of environment variables</strong></p><p>You can find a list of additional configuration settings in-depth on the
<a href=../technical-documentation/env.md>Configuration</a> page, but the important variables will be listed in the below subsections.</p></div><h3 class=heading id=app-variables><span class=heading__text>App variables</span>
<a class=heading__anchor-link href=#app-variables>[link]</a></h3><ul><li>Set <code>APP_NAME</code> to your desired title, e.g. <code>Pixelfed</code>. This will be shown in the header bar and other places.</li><li>Ensure that <code>APP_DEBUG</code> is <code>false</code> for production environments, or <code>true</code> for debug environments.</li><li>Set your <code>APP_URL</code> to the HTTPS URL that you wish to serve Pixelfed through, e.g. <code>https://pixelfed.example</code></li><li>Set <code>APP_DOMAIN</code>, <code>ADMIN_DOMAIN</code>, and <code>SESSION_DOMAIN</code> to the domain name you will be using for Pixelfed, e.g. <code>pixelfed.example</code></li></ul><h3 class=heading id=database-variables><span class=heading__text>Database variables</span>
<a class=heading__anchor-link href=#database-variables>[link]</a></h3><p>By default, the values provided will allow connecting to MySQL or MariaDB over the default localhost TCP connection.</p><p>If you are running Postgres:</p><ul><li>Set <code>DB_CONNECTION</code> to <code>pgsql</code> instead of <code>mysql</code>.</li></ul><p>If you are running your SQL server on a different machine or port:</p><ul><li>Set <code>DB_HOST</code> to the IP of the machine</li><li>Set <code>DB_PORT</code> to the port on which your database server is exposed</li></ul><p>Alternatively, if you are using a Unix socket:</p><ul><li>Set <code>DB_SOCKET</code> to the path of the socket, e.g. <code>/run/mysqld/mysqld.sock</code></li></ul><p>To connect to the database you created:</p><ul><li>Set <code>DB_DATABASE</code> to the name of the database created for Pixelfed</li><li>Set <code>DB_USERNAME</code> to the user that was granted privileges for that database</li><li>Set <code>DB_PASSWORD</code> to the password that identifies the user with privileges to the database</li></ul><h3 class=heading id=redis-variables><span class=heading__text>Redis variables</span>
<a class=heading__anchor-link href=#redis-variables>[link]</a></h3><p>If you are running Redis over TCP on the same machine as Pixelfed, then the default settings will work.</p><p>If you are running Redis on another machine:</p><ul><li>Set <code>REDIS_HOST</code> to the IP of the machine your Redis server is running on</li><li>Set <code>REDIS_PORT</code> to the port on which Redis is exposed</li><li>Set <code>REDIS_PASSWORD</code> to the password of that Redis server</li></ul><p>If you are using a Unix socket for Redis, then:</p><ul><li>Set <code>REDIS_SCHEME</code> to <code>unix</code></li><li>Set <code>REDIS_HOST</code> to the path of the socket, e.g. <code>/run/redis/redis.sock</code></li><li>Set <code>REDIS_PORT</code> to <code>0</code></li></ul><div class='tip hint'><p><strong>TCP server vs. Unix socket</strong></p><p>Redis usually comes pre-configured to listen for TCP requests on the local machine over port 6379. In your Redis configuration, typically at <code>/etc/redis.conf</code>, the relevant lines are <code>bind 127.0.0.1</code> and <code>port 6379</code>.</p><p>Changing the latter line to <code>port 0</code> will disable TCP listening, in which case Redis must be configured for socket access. Lines such as <code>unixsocket /run/redis/redis.sock</code> and <code>unixsocketperm 770</code> must be set to enable socket access. Additionally, both the app user and web user should have permission to access the socket, e.g. by being added to the <code>redis</code> group.</p><p>Using a Unix socket is optional, but may provide faster access since it does not have to create TCP packets. TCP is usually used over a network, and would be required if Redis were running on a different machine than your web server.</p></div><h3 class=heading id=email-variables><span class=heading__text>Email variables</span>
<a class=heading__anchor-link href=#email-variables>[link]</a></h3><p>By default, Pixelfed will not send any emails, but will instead write messages to the Laravel log.</p><p>To setup a mailer for production deployments, you have several options for supported mail services. Pixelfed currently supports SMTP, Mailgun, Postmark, Amazon SES, and <code>sendmail</code> for sending emails to users.</p><ul><li>Set <code>MAIL_FROM_ADDRESS</code> to the email address you want to send from</li><li>Set <code>MAIL_FROM_NAME</code> to the name you want to appear on emails</li><li>Set <code>MAIL_ENCRYPTION</code> to <code>tls</code> in order to have emails be properly delivered</li></ul><h4 class=heading id=smtp-mailtrap><span class=heading__text>SMTP (Mailtrap)</span>
<a class=heading__anchor-link href=#smtp-mailtrap>[link]</a></h4><p>Set up your SMTP server. Or, create an account with
<a href=https://mailtrap.io target=_blank>Mailtrap<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1e3 1e3" width="1em" title="external link"><path fill="currentcolor" d="M609.34 13.31c-23.11 8.5-28.16 20.46-28.42 65.35.0 29.49.8 34.8 6.11 45.16 10.89 21.52 13.81 22.31 96.96 23.91l72.25 1.33L568.7 336.32C465.63 439.39 379.57 526.79 377.44 530.77c-4.78 9.3-4.78 24.17.0 33.47 2.13 3.98 15.67 18.86 30.28 33.47 24.17 23.91 27.36 26.3 38.52 27.36 6.64.8 15.41.53 19.66-.26 5.05-1.33 65.88-60.3 196.04-190.46C765.8 330.74 851.6 246.01 852.66 246.01s1.86 32.67 1.86 72.78c0 70.93.26 72.78 6.11 81.29 11.16 16.47 19.39 18.86 63.49 18.06 42.5-.8 46.49-2.12 58.97-19.13 5.58-7.17 5.58-10.36 6.37-180.37l.53-173.2-5.84-11.95c-3.72-6.91-9.83-14.08-15.41-17.27-9.03-5.05-14.08-5.31-179.31-5.84-137.59-.53-171.85.01-180.09 2.93z"/><path fill="currentcolor" d="M100.12 121.42c-29.75 5.05-57.91 24.44-73.58 50.47-17.8 29.49-17 10.63-16.2 390.49l.8 343.73 8.5 17.8c9.56 20.19 27.89 41.44 44.36 51 26.83 15.67 8.5 14.87 381.46 14.87 306.28.0 343.2-.53 356.22-4.25 38.25-11.42 68.01-43.57 76.51-82.88 2.13-9.83 2.92-81.82 2.92-235.62v-221.8H745.63v409.08H145.27V256.63h409.08V118.5l-219.68.27c-121.13.26-226.59 1.32-234.55 2.65z"/></svg></a>.</p><ul><li>Set <code>MAIL_DRIVER</code> to <code>smtp</code></li><li>Set <code>MAIL_HOST</code> to your host, e.g. <code>smtp.mailtrap.io</code></li><li>Set <code>MAIL_PORT</code> to your port, e.g. <code>587</code> or <code>2525</code></li><li>Set <code>MAIL_USERNAME</code> and <code>MAIL_PASSWORD</code> if your SMTP server requires authorization. (Mailtrap.io does not.)</li></ul><h4 class=heading id=mailgun><span class=heading__text>Mailgun</span>
<a class=heading__anchor-link href=#mailgun>[link]</a></h4><p>Create an account with
<a href=https://mailgun.com/ target=_blank>Mailgun<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1e3 1e3" width="1em" title="external link"><path fill="currentcolor" d="M609.34 13.31c-23.11 8.5-28.16 20.46-28.42 65.35.0 29.49.8 34.8 6.11 45.16 10.89 21.52 13.81 22.31 96.96 23.91l72.25 1.33L568.7 336.32C465.63 439.39 379.57 526.79 377.44 530.77c-4.78 9.3-4.78 24.17.0 33.47 2.13 3.98 15.67 18.86 30.28 33.47 24.17 23.91 27.36 26.3 38.52 27.36 6.64.8 15.41.53 19.66-.26 5.05-1.33 65.88-60.3 196.04-190.46C765.8 330.74 851.6 246.01 852.66 246.01s1.86 32.67 1.86 72.78c0 70.93.26 72.78 6.11 81.29 11.16 16.47 19.39 18.86 63.49 18.06 42.5-.8 46.49-2.12 58.97-19.13 5.58-7.17 5.58-10.36 6.37-180.37l.53-173.2-5.84-11.95c-3.72-6.91-9.83-14.08-15.41-17.27-9.03-5.05-14.08-5.31-179.31-5.84-137.59-.53-171.85.01-180.09 2.93z"/><path fill="currentcolor" d="M100.12 121.42c-29.75 5.05-57.91 24.44-73.58 50.47-17.8 29.49-17 10.63-16.2 390.49l.8 343.73 8.5 17.8c9.56 20.19 27.89 41.44 44.36 51 26.83 15.67 8.5 14.87 381.46 14.87 306.28.0 343.2-.53 356.22-4.25 38.25-11.42 68.01-43.57 76.51-82.88 2.13-9.83 2.92-81.82 2.92-235.62v-221.8H745.63v409.08H145.27V256.63h409.08V118.5l-219.68.27c-121.13.26-226.59 1.32-234.55 2.65z"/></svg></a>.</p><ul><li>Set <code>MAIL_DRIVER</code> to <code>mailgun</code></li><li>Set <code>MAIL_HOST</code> to <code>smtp.mailgun.org</code></li><li>Set <code>MAIL_PORT</code> to <code>587</code></li><li>Set <code>MAIL_USERNAME</code> to your Mailgun domain</li><li>Set <code>MAIL_PASSWORD</code> to your Mailgun API key</li></ul><p>If you are not using the &ldquo;US&rdquo;
<a href=https://documentation.mailgun.com/en/latest/api-intro.html#mailgun-regions target=_blank>Mailgun region<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1e3 1e3" width="1em" title="external link"><path fill="currentcolor" d="M609.34 13.31c-23.11 8.5-28.16 20.46-28.42 65.35.0 29.49.8 34.8 6.11 45.16 10.89 21.52 13.81 22.31 96.96 23.91l72.25 1.33L568.7 336.32C465.63 439.39 379.57 526.79 377.44 530.77c-4.78 9.3-4.78 24.17.0 33.47 2.13 3.98 15.67 18.86 30.28 33.47 24.17 23.91 27.36 26.3 38.52 27.36 6.64.8 15.41.53 19.66-.26 5.05-1.33 65.88-60.3 196.04-190.46C765.8 330.74 851.6 246.01 852.66 246.01s1.86 32.67 1.86 72.78c0 70.93.26 72.78 6.11 81.29 11.16 16.47 19.39 18.86 63.49 18.06 42.5-.8 46.49-2.12 58.97-19.13 5.58-7.17 5.58-10.36 6.37-180.37l.53-173.2-5.84-11.95c-3.72-6.91-9.83-14.08-15.41-17.27-9.03-5.05-14.08-5.31-179.31-5.84-137.59-.53-171.85.01-180.09 2.93z"/><path fill="currentcolor" d="M100.12 121.42c-29.75 5.05-57.91 24.44-73.58 50.47-17.8 29.49-17 10.63-16.2 390.49l.8 343.73 8.5 17.8c9.56 20.19 27.89 41.44 44.36 51 26.83 15.67 8.5 14.87 381.46 14.87 306.28.0 343.2-.53 356.22-4.25 38.25-11.42 68.01-43.57 76.51-82.88 2.13-9.83 2.92-81.82 2.92-235.62v-221.8H745.63v409.08H145.27V256.63h409.08V118.5l-219.68.27c-121.13.26-226.59 1.32-234.55 2.65z"/></svg></a>, you may define your region&rsquo;s endpoint in the <code>services.php</code> configuration file located in the <code>config/</code> directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=s1>&#39;mailgun&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;domain&#39;</span> <span class=o>=&gt;</span> <span class=nx>env</span><span class=p>(</span><span class=s1>&#39;MAILGUN_DOMAIN&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;secret&#39;</span> <span class=o>=&gt;</span> <span class=nx>env</span><span class=p>(</span><span class=s1>&#39;MAILGUN_SECRET&#39;</span><span class=p>),</span>
</span></span><span class="line hl"><span class=cl>    <span class=s1>&#39;endpoint&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;api.eu.mailgun.net&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>],</span>
</span></span></code></pre></div><h4 class=heading id=postmark><span class=heading__text>Postmark</span>
<a class=heading__anchor-link href=#postmark>[link]</a></h4><p>To use the Postmark driver, install Postmark&rsquo;s SwiftMailer transport via Composer:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>composer require wildbit/swiftmailer-postmark
</span></span></code></pre></div><p>Next, install Guzzle and set the <code>driver</code> option in your <code>config/mail.php</code> configuration file to <code>postmark</code>. Finally, verify that your <code>config/services.php</code> configuration file contains the following options:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=s1>&#39;postmark&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;token&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;your-postmark-token&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>],</span>
</span></span></code></pre></div><h4 class=heading id=amazon-ses><span class=heading__text>Amazon SES</span>
<a class=heading__anchor-link href=#amazon-ses>[link]</a></h4><p>Create an account with Amazon AWS.</p><ul><li>Set <code>MAIL_DRIVER</code> to <code>ses</code></li><li>Set <code>SES_KEY</code></li><li>Set <code>SES_SECRET</code></li><li>Set <code>SES_REGION</code> (if not using the default of <code>us-east-1</code>)</li></ul><h4 class=heading id=sendmail><span class=heading__text>sendmail</span>
<a class=heading__anchor-link href=#sendmail>[link]</a></h4><ul><li>Set <code>MAIL_DRIVER</code> to <code>sendmail</code></li></ul><h3 class=heading id=additional-variables><span class=heading__text>Additional variables</span>
<a class=heading__anchor-link href=#additional-variables>[link]</a></h3><p>If you are using ImageMagick, then:</p><ul><li>Set <code>IMAGE_DRIVER</code> to <code>imagick</code></li></ul><p>If you want to enable ActivityPub federation:</p><ul><li>Set <code>ACTIVITY_PUB</code> to <code>true</code></li><li>Set <code>AP_REMOTE_FOLLOW</code> to <code>true</code></li></ul><p>If you want to enable OAuth support for external clients:</p><ul><li>Set <code>OAUTH_ENABLED</code> to <code>true</code></li></ul><h2 class=heading id=setting-up-services><span class=heading__text>Setting up services</span>
<a class=heading__anchor-link href=#setting-up-services>[link]</a></h2><h3 class=heading id=one-time-setup-tasks><span class=heading__text>One-time setup tasks</span>
<a class=heading__anchor-link href=#one-time-setup-tasks>[link]</a></h3><p>One time only, you need to generate the secret <code>APP_KEY</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan key:generate
</span></span></code></pre></div><p>One time only, the <code>storage/</code> directory must be linked to the application:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan storage:link
</span></span></code></pre></div><p>Database migrations must be run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan migrate --force
</span></span></code></pre></div><p>If you want to enable support for location data:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan import:cities
</span></span></code></pre></div><p>If you enabled ActivityPub federation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan instance:actor
</span></span></code></pre></div><p>If you enabled OAuth:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan passport:keys
</span></span></code></pre></div><p>Routes should be cached whenever the source code changes or whenever you change routes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan route:cache
</span></span><span class=line><span class=cl>php artisan view:cache
</span></span></code></pre></div><p>Every time you edit your .env file, you must run this command to have the changes take effect:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan config:cache
</span></span></code></pre></div><div class='tip hint'><p><strong>Running Pixelfed without a cache</strong></p><p>It is possible to not use a cache by not running the above cache commands, but it is recommended to run these for production deployments. If you choose not to run these commands, then you can freely edit the .env file and source code instead, and your changes will be reflected instantly, but performance may take a slight hit. You can also undo these commands by running <code>:clear</code> commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan route:clear
</span></span><span class=line><span class=cl>php artisan view:clear
</span></span><span class=line><span class=cl>php artisan config:clear
</span></span></code></pre></div></div><h3 class=heading id=job-queueing><span class=heading__text>Job queueing</span>
<a class=heading__anchor-link href=#job-queueing>[link]</a></h3><p>Pixelfed supports both
<a href=https://laravel.com/docs/6.x/horizon target=_blank>Laravel Horizon<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1e3 1e3" width="1em" title="external link"><path fill="currentcolor" d="M609.34 13.31c-23.11 8.5-28.16 20.46-28.42 65.35.0 29.49.8 34.8 6.11 45.16 10.89 21.52 13.81 22.31 96.96 23.91l72.25 1.33L568.7 336.32C465.63 439.39 379.57 526.79 377.44 530.77c-4.78 9.3-4.78 24.17.0 33.47 2.13 3.98 15.67 18.86 30.28 33.47 24.17 23.91 27.36 26.3 38.52 27.36 6.64.8 15.41.53 19.66-.26 5.05-1.33 65.88-60.3 196.04-190.46C765.8 330.74 851.6 246.01 852.66 246.01s1.86 32.67 1.86 72.78c0 70.93.26 72.78 6.11 81.29 11.16 16.47 19.39 18.86 63.49 18.06 42.5-.8 46.49-2.12 58.97-19.13 5.58-7.17 5.58-10.36 6.37-180.37l.53-173.2-5.84-11.95c-3.72-6.91-9.83-14.08-15.41-17.27-9.03-5.05-14.08-5.31-179.31-5.84-137.59-.53-171.85.01-180.09 2.93z"/><path fill="currentcolor" d="M100.12 121.42c-29.75 5.05-57.91 24.44-73.58 50.47-17.8 29.49-17 10.63-16.2 390.49l.8 343.73 8.5 17.8c9.56 20.19 27.89 41.44 44.36 51 26.83 15.67 8.5 14.87 381.46 14.87 306.28.0 343.2-.53 356.22-4.25 38.25-11.42 68.01-43.57 76.51-82.88 2.13-9.83 2.92-81.82 2.92-235.62v-221.8H745.63v409.08H145.27V256.63h409.08V118.5l-219.68.27c-121.13.26-226.59 1.32-234.55 2.65z"/></svg></a> and
<a href=https://laravel.com/docs/6.x/queues target=_blank>Queue Workers<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1e3 1e3" width="1em" title="external link"><path fill="currentcolor" d="M609.34 13.31c-23.11 8.5-28.16 20.46-28.42 65.35.0 29.49.8 34.8 6.11 45.16 10.89 21.52 13.81 22.31 96.96 23.91l72.25 1.33L568.7 336.32C465.63 439.39 379.57 526.79 377.44 530.77c-4.78 9.3-4.78 24.17.0 33.47 2.13 3.98 15.67 18.86 30.28 33.47 24.17 23.91 27.36 26.3 38.52 27.36 6.64.8 15.41.53 19.66-.26 5.05-1.33 65.88-60.3 196.04-190.46C765.8 330.74 851.6 246.01 852.66 246.01s1.86 32.67 1.86 72.78c0 70.93.26 72.78 6.11 81.29 11.16 16.47 19.39 18.86 63.49 18.06 42.5-.8 46.49-2.12 58.97-19.13 5.58-7.17 5.58-10.36 6.37-180.37l.53-173.2-5.84-11.95c-3.72-6.91-9.83-14.08-15.41-17.27-9.03-5.05-14.08-5.31-179.31-5.84-137.59-.53-171.85.01-180.09 2.93z"/><path fill="currentcolor" d="M100.12 121.42c-29.75 5.05-57.91 24.44-73.58 50.47-17.8 29.49-17 10.63-16.2 390.49l.8 343.73 8.5 17.8c9.56 20.19 27.89 41.44 44.36 51 26.83 15.67 8.5 14.87 381.46 14.87 306.28.0 343.2-.53 356.22-4.25 38.25-11.42 68.01-43.57 76.51-82.88 2.13-9.83 2.92-81.82 2.92-235.62v-221.8H745.63v409.08H145.27V256.63h409.08V118.5l-219.68.27c-121.13.26-226.59 1.32-234.55 2.65z"/></svg></a> to power the job queue. The main difference between Horizon and Queue Worker is the dashboard provided by Horizon as well as advanced load balancing. We recommend using Horizon. Horizon provides a beautiful dashboard which allows you to easily monitor key metrics of your queue system such as job throughput, runtime, and job failures.</p><h4 class=heading id=using-laravel-horizon><span class=heading__text>Using Laravel Horizon</span>
<a class=heading__anchor-link href=#using-laravel-horizon>[link]</a></h4><p>If you want admins to be able to access the Horizon web dashboard, you will need to run the following commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan horizon:install
</span></span><span class=line><span class=cl>php artisan horizon:publish
</span></span></code></pre></div><p>If your user has the correct permissions to access Redis and the Pixelfed installation folder, then you can simply run <code>php artisan horizon</code> as that user in a terminal. This may be fine, but if you close the terminal then Horizon will also be terminated. Running directly is recommended only in deployments where a terminal can run uninterrupted, e.g. in a VM or using a utility such as GNU Screen or tmux.</p><p>If you are running in production, it is more ideal to create a background service for running Pixelfed&rsquo;s task queue. You will need to use a task manager like systemd or Supervisor. For more information, refer to the
<a href=https://laravel.com/docs/6.x/horizon#deploying-horizon target=_blank>Laravel Documentation<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1e3 1e3" width="1em" title="external link"><path fill="currentcolor" d="M609.34 13.31c-23.11 8.5-28.16 20.46-28.42 65.35.0 29.49.8 34.8 6.11 45.16 10.89 21.52 13.81 22.31 96.96 23.91l72.25 1.33L568.7 336.32C465.63 439.39 379.57 526.79 377.44 530.77c-4.78 9.3-4.78 24.17.0 33.47 2.13 3.98 15.67 18.86 30.28 33.47 24.17 23.91 27.36 26.3 38.52 27.36 6.64.8 15.41.53 19.66-.26 5.05-1.33 65.88-60.3 196.04-190.46C765.8 330.74 851.6 246.01 852.66 246.01s1.86 32.67 1.86 72.78c0 70.93.26 72.78 6.11 81.29 11.16 16.47 19.39 18.86 63.49 18.06 42.5-.8 46.49-2.12 58.97-19.13 5.58-7.17 5.58-10.36 6.37-180.37l.53-173.2-5.84-11.95c-3.72-6.91-9.83-14.08-15.41-17.27-9.03-5.05-14.08-5.31-179.31-5.84-137.59-.53-171.85.01-180.09 2.93z"/><path fill="currentcolor" d="M100.12 121.42c-29.75 5.05-57.91 24.44-73.58 50.47-17.8 29.49-17 10.63-16.2 390.49l.8 343.73 8.5 17.8c9.56 20.19 27.89 41.44 44.36 51 26.83 15.67 8.5 14.87 381.46 14.87 306.28.0 343.2-.53 356.22-4.25 38.25-11.42 68.01-43.57 76.51-82.88 2.13-9.83 2.92-81.82 2.92-235.62v-221.8H745.63v409.08H145.27V256.63h409.08V118.5l-219.68.27c-121.13.26-226.59 1.32-234.55 2.65z"/></svg></a>.</p><p>Most distributions will already come with systemd, so you may set up this unit file at <code>/etc/systemd/system/pixelfed.service</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Pixelfed task queueing via Laravel Horizon</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class="line hl"><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>mariadb</span>
</span></span><span class="line hl"><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>php-fpm</span>
</span></span><span class="line hl"><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>redis</span>
</span></span><span class="line hl"><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>nginx</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple</span>
</span></span><span class="line hl"><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/php /usr/share/webapps/pixelfed/artisan horizon</span>
</span></span><span class="line hl"><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>http</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span></code></pre></div><div class='tip hint'><p><strong>Using correct paths and service names</strong></p><p>The example above assumes you are using MariaDB and Nginx, that your distribution&rsquo;s PHP packages do not have versioned names, and that your distribution uses the <code>http</code> user to serve Nginx. It also assumes that you have installed Pixelfed in /usr/share/webapps/pixelfed in accordance with the rest of the installation process documentation. Some changes you may need to make include:</p><ul><li>Replacing <code>mariadb</code> with <code>postgresql</code> or <code>mysql</code></li><li>Replacing <code>php-fpm</code> with your distro&rsquo;s PHP-FPM package name, e.g. <code>php8.1-fpm</code></li><li>Replacing <code>nginx</code> with <code>apache</code>, or replacing <code>Requires</code> with <code>Wants</code> if you are not running in a production environment</li><li>Replacing <code>/usr/bin/php</code> or <code>/usr/share/webapps/pixelfed/artisan</code> with the correct paths, e.g. <code>/usr/bin/php8.1</code> or <code>/path/to/pixelfed/artisan</code></li><li>Replacing <code>User=http</code> to reflect the app user, e.g. <code>User=pixelfed</code> or commenting this line in order to run in the system slice.</li></ul></div><p>You can now use systemd to manage Pixelfed like any other background service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> --now pixelfed
</span></span></code></pre></div><p>Alternatively, if you do not wish to use systemd, then you can install Supervisor and create this sample Supervisor configuration file at <code>/etc/supervisor/conf.d/pixelfed.conf</code>, making sure to use the correct path to your Pixelfed installation and the appropriate app-user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[program:pixelfed]</span>
</span></span><span class="line hl"><span class=cl><span class=na>command</span><span class=o>=</span><span class=s>/usr/bin/php /usr/share/webapps/pixelfed/artisan horizon</span>
</span></span><span class="line hl"><span class=cl><span class=na>user</span><span class=o>=</span><span class=s>http</span>
</span></span><span class=line><span class=cl><span class=na>autorestart</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>redirect_stderr</span><span class=o>=</span><span class=s>true</span>
</span></span><span class="line hl"><span class=cl><span class=na>stdout_logfile</span><span class=o>=</span><span class=s>/usr/share/webapps/pixelfed/horizon.log</span>
</span></span><span class=line><span class=cl><span class=na>stopwaitsecs</span><span class=o>=</span><span class=s>3600</span>
</span></span></code></pre></div><div class='tip hint'><p><strong>Using correct paths</strong></p><p>You may need to replace <code>/usr/bin/php</code> or <code>/usr/share/webapps/pixelfed/artisan</code> with the correct paths, e.g. <code>/usr/bin/php8.1</code> or <code>/path/to/pixelfed/artisan</code></p></div><p>You will then need to run these commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo supervisorctl reread
</span></span><span class=line><span class=cl>sudo supervisorctl update
</span></span><span class=line><span class=cl>sudo supervisorctl start pixelfed
</span></span></code></pre></div><h4 class=heading id=using-queue-worker><span class=heading__text>Using Queue Worker</span>
<a class=heading__anchor-link href=#using-queue-worker>[link]</a></h4><p>Pixelfed also includes a queue worker that will process new jobs as they are pushed onto the queue. You may run the worker using the <code>queue:work</code> command. Note that once the command has started, it will continue to run until it is manually stopped or you close your terminal:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan queue:work
</span></span></code></pre></div><p>Again, you can use Supervisor or systemd as described above, substituting <code>horizon</code> for <code>queue:work</code>.</p><h3 class=heading id=scheduling-periodic-tasks><span class=heading__text>Scheduling periodic tasks</span>
<a class=heading__anchor-link href=#scheduling-periodic-tasks>[link]</a></h3><p>The task scheduler is used to run periodic commands in the background, such as media optimization, garbage collection, and other time-based tasks that should be run every once in a while.</p><p>To set up scheduled tasks using Cron:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>EDITOR</span><span class=o>=</span>nano crontab -e
</span></span></code></pre></div><p>Paste the following cronjob into your crontab:</p><pre tabindex=0><code>* * * * * /usr/bin/php /usr/share/webapps/pixelfed/artisan schedule:run &gt;&gt; /dev/null 2&gt;&amp;1
</code></pre><div class='tip hint'><p><strong>Using correct paths</strong></p><p>You may need to replace <code>/usr/bin/php</code> or <code>/usr/share/webapps/pixelfed/artisan</code> with the correct paths, e.g. <code>/usr/bin/php7.3</code> or <code>/path/to/pixelfed/artisan</code></p></div><h3 class=heading id=handling-web-requests><span class=heading__text>Handling web requests</span>
<a class=heading__anchor-link href=#handling-web-requests>[link]</a></h3><p>To translate HTTPS web requests to PHP workers, you will need to configure a reverse proxy.</p><h4 class=heading id=apache><span class=heading__text>Apache</span>
<a class=heading__anchor-link href=#apache>[link]</a></h4><p>Pixelfed includes a <code>public/.htaccess</code> file that is used to provide URLs without the index.php front controller in the path. Before serving Pixelfed with Apache, be sure to enable the <code>mod_rewrite</code> module in your Apache configuration so the <code>.htaccess</code> file will be honored by the server.</p><p>If the <code>.htaccess</code> file that ships with Pixelfed does not work with your Apache installation, try this alternative:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Options</span> <span class=o>+</span><span class=nx>FollowSymLinks</span> <span class=o>-</span><span class=nx>Indexes</span>
</span></span><span class=line><span class=cl><span class=nx>RewriteEngine</span> <span class=nx>On</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>RewriteCond</span> <span class=o>%</span><span class=p>{</span><span class=nx>HTTP</span><span class=o>:</span><span class=nx>Authorization</span><span class=p>}</span> <span class=o>.</span>
</span></span><span class=line><span class=cl><span class=nx>RewriteRule</span> <span class=o>.*</span> <span class=o>-</span> <span class=p>[</span><span class=nx>E</span><span class=o>=</span><span class=nx>HTTP_AUTHORIZATION</span><span class=o>:%</span><span class=p>{</span><span class=nx>HTTP</span><span class=o>:</span><span class=nx>Authorization</span><span class=p>}]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>RewriteCond</span> <span class=o>%</span><span class=p>{</span><span class=nx>REQUEST_FILENAME</span><span class=p>}</span> <span class=o>!-</span><span class=nx>d</span>
</span></span><span class=line><span class=cl><span class=nx>RewriteCond</span> <span class=o>%</span><span class=p>{</span><span class=nx>REQUEST_FILENAME</span><span class=p>}</span> <span class=o>!-</span><span class=nx>f</span>
</span></span><span class=line><span class=cl><span class=nx>RewriteRule</span> <span class=o>^</span> <span class=nx>index</span><span class=o>.</span><span class=nx>php</span> <span class=p>[</span><span class=nx>L</span><span class=p>]</span>
</span></span></code></pre></div><h4 class=heading id=nginx><span class=heading__text>Nginx</span>
<a class=heading__anchor-link href=#nginx>[link]</a></h4><p>Pixelfed includes a sample NGINX configuration at <code>contrib/nginx.conf</code>. You can copy the contents of this file or include it within your <code>nginx.conf</code>. Take note of the comments, and make sure to set the correct domain name and root path.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>443</span> <span class=s>ssl</span> <span class=s>http2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:443</span> <span class=s>ssl</span> <span class=s>http2</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl>    <span class=kn>server_name</span> <span class=s>pixelfed.example</span><span class=p>;</span>                    <span class=c1># change this to your fqdn
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=kn>root</span> <span class=s>/usr/share/webapps/pixelfed/public</span><span class=p>;</span>         <span class=c1># path to repo/public
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl>    <span class=kn>ssl_certificate</span> <span class=s>/etc/nginx/ssl/server.crt</span><span class=p>;</span>       <span class=c1># generate your own
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=kn>ssl_certificate_key</span> <span class=s>/etc/nginx/ssl/server.key</span><span class=p>;</span>   <span class=c1># or use letsencrypt
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_protocols</span> <span class=s>TLSv1.2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span> <span class=s>EECDH+AESGCM:EECDH+CHACHA20:EECDH+AES</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span> <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>add_header</span> <span class=s>X-Frame-Options</span> <span class=s>&#34;SAMEORIGIN&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>add_header</span> <span class=s>X-XSS-Protection</span> <span class=s>&#34;1</span><span class=p>;</span> <span class=kn>mode=block&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>add_header</span> <span class=s>X-Content-Type-Options</span> <span class=s>&#34;nosniff&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>index</span> <span class=s>index.html</span> <span class=s>index.htm</span> <span class=s>index.php</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>charset</span> <span class=s>utf-8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>client_max_body_size</span> <span class=s>15M</span><span class=p>;</span>   <span class=c1># or your desired limit
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>try_files</span> <span class=nv>$uri</span> <span class=nv>$uri/</span> <span class=s>/index.php?</span><span class=nv>$query_string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=p>=</span> <span class=s>/favicon.ico</span> <span class=p>{</span> <span class=kn>access_log</span> <span class=no>off</span><span class=p>;</span> <span class=kn>log_not_found</span> <span class=no>off</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=p>=</span> <span class=s>/robots.txt</span>  <span class=p>{</span> <span class=kn>access_log</span> <span class=no>off</span><span class=p>;</span> <span class=kn>log_not_found</span> <span class=no>off</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>error_page</span> <span class=mi>404</span> <span class=s>/index.php</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=p>~</span> <span class=sr>\.php$</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>fastcgi_split_path_info</span> <span class=s>^(.+\.php)(/.+)</span>$<span class=p>;</span>
</span></span><span class="line hl"><span class=cl>        <span class=kn>fastcgi_pass</span> <span class=s>unix:/run/php-fpm/php-fpm.sock</span><span class=p>;</span> <span class=c1># make sure this is correct
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kn>fastcgi_index</span> <span class=s>index.php</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>include</span> <span class=s>fastcgi_params</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl>        <span class=kn>fastcgi_param</span> <span class=s>SCRIPT_FILENAME</span> <span class=nv>$document_root$fastcgi_script_name</span><span class=p>;</span> <span class=c1># or $request_filename
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=p>~</span> <span class=sr>/\.(?!well-known).*</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>deny</span> <span class=s>all</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>                                             <span class=c1># Redirect http to https
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=kn>server_name</span> <span class=s>pixelfed.example</span><span class=p>;</span>                    <span class=c1># change this to your fqdn
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class='tip hint'><p><strong>FastCGI path</strong></p><p>Make sure to use the correct <code>fastcgi_pass</code> socket path for your distribution and version of PHP-FPM. For example, on Arch, this is <code>/run/php-fpm/php-fpm.sock</code>, but on Ubuntu it may be <code>/run/php/php8.1-fpm.sock</code>, on Debian it may be <code>/var/run/php/php8.1-fpm.sock</code>, and so on. If you have configured a PHP server over TCP, you may also pass to its IP and port, e.g. <code>localhost:9000</code> by default.</p></div><div class='warning hint'><p><strong>Nginx web root</strong></p><p>Make sure to use the <code>/public</code> folder as your server root. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>root</span> <span class=s>/var/www/pixelfed/public</span><span class=p>;</span>
</span></span></code></pre></div><p>If you set root to the install directory (example: <code>root /var/www/pixelfed;</code>) Pixelfed will not work.</p></div><div class='tip hint'><p><strong>Nginx client max body size</strong></p><p>Make sure to set an appropriate <code>client_max_body_size</code> setting in the <code>nginx.conf</code> file. Set this slightly greater than your desired post size limit for file uploads. The <code>nginx.conf</code> file location will vary based on your server. <code>/etc/nginx/nginx.conf</code></p><p>Example:<code>http {client_max_body_size 9m;}</code></p></div><h4 class=heading id=obtaining-an-https-certificate><span class=heading__text>Obtaining an HTTPS certificate</span>
<a class=heading__anchor-link href=#obtaining-an-https-certificate>[link]</a></h4><p>For testing deployments, you may generate a self-signed SSL certificate. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mkdir /etc/nginx/ssl
</span></span><span class=line><span class=cl>sudo openssl req -x509 -nodes -days <span class=m>365</span> -newkey rsa:2048 -keyout /etc/nginx/ssl/server.key -out /etc/nginx/ssl/server.crt
</span></span></code></pre></div><p>For production deployments, you will need to obtain a certificate from a certificate authority. You may automate certification from LetsEncrypt, a free certificate authority, by using a utility such as
<a href=https://certbot.eff.org/ target=_blank>EFF Certbot<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1e3 1e3" width="1em" title="external link"><path fill="currentcolor" d="M609.34 13.31c-23.11 8.5-28.16 20.46-28.42 65.35.0 29.49.8 34.8 6.11 45.16 10.89 21.52 13.81 22.31 96.96 23.91l72.25 1.33L568.7 336.32C465.63 439.39 379.57 526.79 377.44 530.77c-4.78 9.3-4.78 24.17.0 33.47 2.13 3.98 15.67 18.86 30.28 33.47 24.17 23.91 27.36 26.3 38.52 27.36 6.64.8 15.41.53 19.66-.26 5.05-1.33 65.88-60.3 196.04-190.46C765.8 330.74 851.6 246.01 852.66 246.01s1.86 32.67 1.86 72.78c0 70.93.26 72.78 6.11 81.29 11.16 16.47 19.39 18.86 63.49 18.06 42.5-.8 46.49-2.12 58.97-19.13 5.58-7.17 5.58-10.36 6.37-180.37l.53-173.2-5.84-11.95c-3.72-6.91-9.83-14.08-15.41-17.27-9.03-5.05-14.08-5.31-179.31-5.84-137.59-.53-171.85.01-180.09 2.93z"/><path fill="currentcolor" d="M100.12 121.42c-29.75 5.05-57.91 24.44-73.58 50.47-17.8 29.49-17 10.63-16.2 390.49l.8 343.73 8.5 17.8c9.56 20.19 27.89 41.44 44.36 51 26.83 15.67 8.5 14.87 381.46 14.87 306.28.0 343.2-.53 356.22-4.25 38.25-11.42 68.01-43.57 76.51-82.88 2.13-9.83 2.92-81.82 2.92-235.62v-221.8H745.63v409.08H145.27V256.63h409.08V118.5l-219.68.27c-121.13.26-226.59 1.32-234.55 2.65z"/></svg></a> or
<a href=https://acme.sh target=_blank>acme.sh<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1e3 1e3" width="1em" title="external link"><path fill="currentcolor" d="M609.34 13.31c-23.11 8.5-28.16 20.46-28.42 65.35.0 29.49.8 34.8 6.11 45.16 10.89 21.52 13.81 22.31 96.96 23.91l72.25 1.33L568.7 336.32C465.63 439.39 379.57 526.79 377.44 530.77c-4.78 9.3-4.78 24.17.0 33.47 2.13 3.98 15.67 18.86 30.28 33.47 24.17 23.91 27.36 26.3 38.52 27.36 6.64.8 15.41.53 19.66-.26 5.05-1.33 65.88-60.3 196.04-190.46C765.8 330.74 851.6 246.01 852.66 246.01s1.86 32.67 1.86 72.78c0 70.93.26 72.78 6.11 81.29 11.16 16.47 19.39 18.86 63.49 18.06 42.5-.8 46.49-2.12 58.97-19.13 5.58-7.17 5.58-10.36 6.37-180.37l.53-173.2-5.84-11.95c-3.72-6.91-9.83-14.08-15.41-17.27-9.03-5.05-14.08-5.31-179.31-5.84-137.59-.53-171.85.01-180.09 2.93z"/><path fill="currentcolor" d="M100.12 121.42c-29.75 5.05-57.91 24.44-73.58 50.47-17.8 29.49-17 10.63-16.2 390.49l.8 343.73 8.5 17.8c9.56 20.19 27.89 41.44 44.36 51 26.83 15.67 8.5 14.87 381.46 14.87 306.28.0 343.2-.53 356.22-4.25 38.25-11.42 68.01-43.57 76.51-82.88 2.13-9.83 2.92-81.82 2.92-235.62v-221.8H745.63v409.08H145.27V256.63h409.08V118.5l-219.68.27c-121.13.26-226.59 1.32-234.55 2.65z"/></svg></a>.</p><p>Sample usage of certbot:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>certbot --nginx -d pixelfed.example
</span></span></code></pre></div></div></section><nav class=section-nav><div class=container><a class=next href=https://docs.pixelfed.org/running-pixelfed/administration/><span class=text>Next page:<br>Administering your website</span><span class=arrow></span></a></div></nav><footer class="section page-footer"><div class=container></div></footer></article></main><footer class=site-footer><hr><div class=container><nav class=footer-nav><ul class=menu><li class=copyright><a href=https://creativecommons.org/licenses/by-sa/4.0/><span style=color:var(--ui-text-bold)><i class="fa fa-cc-cc"></i><i class="fa fa-cc-by"></i><i class="fa fa-cc-sa"></i></span>
<span>CC BY-SA 4.0</span></a></li></ul></nav><nav class=social-nav><ul class=menu><li class=mastodon><a href=https://mastodon.social/@pixelfed><svg height="1em" viewbox="0 0 75 79" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M73.84 17.49C72.696 9.002 65.3 2.312 56.53 1.016 55.05.797 49.444.0 36.458.0h-.097c-12.99.0-15.776.797-17.256 1.016-8.525 1.26-16.311 7.271-18.2 15.86-.909 4.23-1.006 8.919-.837 13.22.24 6.17.288 12.327.848 18.47a86.879 86.879.0 002.022 12.115c1.795 7.361 9.064 13.487 16.185 15.986a43.41 43.41.0 0023.68 1.25 34.565 34.565.0 002.562-.701c1.91-.607 4.147-1.285 5.792-2.477a.187.187.0 00.076-.144v-5.953a.175.175.0 00-.216-.17A65.637 65.637.0 0135.65 70.268c-8.906.0-11.301-4.226-11.987-5.985a18.554 18.554.0 01-1.042-4.718.171.171.0 01.136-.178.173.173.0 01.08.002 64.383 64.383.0 0015.115 1.795c1.225.0 2.446.0 3.67-.032 5.121-.144 10.52-.406 15.558-1.39.125-.025.251-.047.359-.079 7.947-1.526 15.51-6.316 16.279-18.445.029-.477.1-5.002.1-5.497.004-1.684.543-11.946-.079-18.251z" fill="url(#a)"/><path d="M61.248 27.026v21.088h-8.356V27.648c0-4.31-1.796-6.507-5.448-6.507-4.015.0-6.026 2.6-6.026 7.735v11.202H33.11V28.875c0-5.134-2.014-7.734-6.03-7.734-3.63.0-5.444 2.198-5.444 6.507v20.466h-8.353V27.026c0-4.308 1.1-7.731 3.3-10.269 2.27-2.531 5.247-3.831 8.942-3.831 4.278.0 7.51 1.644 9.665 4.93l2.079 3.49 2.083-3.49c2.154-3.286 5.386-4.93 9.657-4.93 3.691.0 6.668 1.3 8.945 3.831 2.198 2.535 3.296 5.958 3.293 10.27z" fill="#fff"/><defs><linearGradient id="a" x1="37.069" y1="0" x2="37.069" y2="79" gradientUnits="userSpaceOnUse"><stop stop-color="#6364ff"/><stop offset="1" stop-color="#563acc"/></linearGradient></defs></svg></a></li><li class=pixelfed><a href=https://pixelfed.social/pixelfed><img src="https://avatars0.githubusercontent.com/u/38410642?s=200&v=4" height=16></a></li><li class=twitter><a href=https://twitter.com/pixelfed><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 248 204" height="1em"><path fill="#1d9bf0" d="M221.95 51.29c.15 2.17.15 4.34.15 6.53.0 66.73-50.8 143.69-143.69 143.69v-.04c-27.44.04-54.31-7.82-77.41-22.64 3.99.48 8 .72 12.02.73 22.74.02 44.83-7.61 62.72-21.66-21.61-.41-40.56-14.5-47.18-35.07a50.338 50.338.0 0022.8-.87C27.8 117.2 10.85 96.5 10.85 72.46v-.64a50.18 50.18.0 0022.92 6.32C11.58 63.31 4.74 33.79 18.14 10.71a143.333 143.333.0 00104.08 52.76 50.532 50.532.0 0114.61-48.25c20.34-19.12 52.33-18.14 71.45 2.19 11.31-2.23 22.15-6.38 32.07-12.26a50.69 50.69.0 01-22.2 27.93c10.01-1.18 19.79-3.86 29-7.95a102.594 102.594.0 01-25.2 26.16z"/></svg></a></li><li class=github><a href=https://github.com/pixelfed/pixelfed><svg style="background:#fff;border:1px solid #fff;border-radius:100rem" height="1em" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59C5.87 15.66 6.02 15.42 6.02 15.21 6.02 15.02 6.01 14.39 6.01 13.72 4 14.09 3.48 13.23 3.32 12.78 3.23 12.55 2.84 11.84 2.5 11.65 2.22 11.5 1.82 11.13 2.49 11.12 3.12 11.11 3.57 11.7 3.72 11.94 4.44 13.15 5.59 12.81 6.05 12.6 6.12 12.08 6.33 11.73 6.56 11.53 4.78 11.33 2.92 10.64 2.92 7.58c0-.87.31-1.59.82-2.15C3.66 5.23 3.38 4.41 3.82 3.31c0 0 .67-.21 2.2.82C6.66 3.95 7.34 3.86 8.02 3.86S9.38 3.95 10.02 4.13c1.53-1.04 2.2-.82 2.2-.82C12.66 4.41 12.38 5.23 12.3 5.43 12.81 5.99 13.12 6.7 13.12 7.58c0 3.07-1.87 3.75-3.65 3.95C9.76 11.78 10.01 12.26 10.01 13.01 10.01 14.08 10 14.94 10 15.21 10 15.42 10.15 15.67 10.55 15.59 13.71 14.53 16 11.53 16 8c0-4.42-3.58-8-8-8z" transform="scale(64)" fill="#1b1f23"/></svg></a></li></ul></nav><a href=#top>back to top</a></div></footer><script src=https://unpkg.com/lunr/lunr.js></script>
<script type=text/javascript src=https://docs.pixelfed.org/scripts/search.min.2a154854f469aeb7a58abc0acf08e4219056bff7fc63c967931f0d6b8b611058.js integrity="sha256-KhVIVPRprrelirwKzwjkIZBWv/f8Y8lnkx8Na4thEFg="></script></body></html>